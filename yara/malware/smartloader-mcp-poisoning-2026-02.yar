/*
 * SmartLoader â€” Trojanized MCP Server Delivering StealC Infostealer
 *
 * Campaign: SmartLoader MCP Poisoning via GitHub Supply Chain (Feb 2026)
 * Source:   Straiker STAR Labs / The Hacker News, Feb 17 2026
 * Author:   Peris.ai Threat Research
 * Date:     2026-02-18
 * TLP:      WHITE
 *
 * Technique: T1195.001 (Supply Chain Compromise), T1059.010 (Lua),
 *            T1555 (Credentials from Password Stores)
 *
 * Description:
 *   Attacker built a fake GitHub ecosystem for months (patient adversary),
 *   then poisoned MCP (Model Context Protocol) registries with a trojanized
 *   Oura Health MCP server. Victims who install the malicious server execute
 *   an obfuscated Lua script that deploys SmartLoader -> StealC infostealer.
 *   Targets developer workstations with high-value credentials (API keys,
 *   SSH keys, crypto wallets, cloud IAM credentials).
 */

rule SmartLoader_MCP_Trojan_2026 {
    meta:
        description = "Detects SmartLoader delivered via trojanized MCP server (Oura MCP campaign Feb 2026)"
        author      = "Peris.ai Threat Research"
        date        = "2026-02-18"
        severity    = "HIGH"
        tlp         = "WHITE"
        threat_name = "SmartLoader"
        campaign    = "SmartLoader-MCP-Poisoning-2026"
        mitre       = "T1195.001, T1059.010, T1555"
        reference   = "https://thehackernews.com/2026/02/researchers-show-copilot-and-grok-can.html"

    strings:
        $lua_obf1    = { 6C 6F 61 64 73 74 72 69 6E 67 }  // "loadstring" hex
        $lua_obf2    = "require" ascii
        $mcp_path1   = "oura-mcp" nocase ascii wide
        $mcp_path2   = "mcp-server" nocase ascii wide
        $stealc1     = "grabber" nocase ascii wide
        $stealc2     = "stealer" nocase ascii wide
        $loader_mark = "SmartLoader" ascii wide

    condition:
        (1 of ($lua_obf*)) and
        (1 of ($mcp_path*)) and
        (1 of ($stealc*) or $loader_mark)
}
