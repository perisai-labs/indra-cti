/*
 * YARA Rule: SSHStalker Linux Botnet
 * Author: Peris.ai Research (Xhavero)
 * Date: 2026-02-17
 * Description: Detects SSHStalker Go-compiled SSH scanner/botnet masquerading as nmap
 * Reference: https://flare.io/learn/resources/blog/old-school-irc-new-victims-inside-the-newly-discovered-sshstalker-linux-botnet
 * TLP: WHITE
 */

rule SSHStalker_Go_SSH_Scanner {
    meta:
        description = "Detects SSHStalker Go-compiled SSH scanner masquerading as nmap"
        author = "Peris.ai Research"
        date = "2026-02-17"
        severity = "high"
        reference = "https://flare.io/learn/resources/blog/old-school-irc-new-victims-inside-the-newly-discovered-sshstalker-linux-botnet"
        tlp = "WHITE"
        mitre_attack = "T1021.004, T1110.003, T1496, T1053"

    strings:
        $go_header = { 7F 45 4C 46 02 01 01 00 }   // ELF64 magic
        $go_string1 = "main.sshScanner" ascii
        $go_string2 = "main.bruteForce" ascii
        $go_string3 = "golang" ascii nocase
        $irc_string = "UnrealIRCd" ascii nocase
        $nmap_fake = "Nmap scan report" ascii       // fake nmap output string used as cover
        $energymech = "EnergyMech" ascii

    condition:
        uint32(0) == 0x464C457F and
        filesize < 20MB and
        (
            (all of ($go_string*)) or
            ($go_string1 and $irc_string) or
            ($go_string2 and $nmap_fake) or
            $energymech
        )
}
