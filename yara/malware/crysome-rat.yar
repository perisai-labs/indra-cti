/*
   YARA Rule: Crysome RAT Detection
   Author: Peris.ai Threat Research Team
   Date: 2026-02-15
   Description: Detects Crysome RAT .NET malware dropped by Amadey botnet
   Reference: SHA256 cfe781129d8db1dcbfdce5fa3b62157bbd6e7a7e8b7f421a4767189463ef28e0
*/

rule Crysome_RAT {
    meta:
        description = "Detects Crysome RAT .NET malware"
        author = "Peris.ai Threat Research Team"
        date = "2026-02-15"
        hash_sha256 = "cfe781129d8db1dcbfdce5fa3b62157bbd6e7a7e8b7f421a4767189463ef28e0"
        severity = "high"
        malware_family = "Crysome"
        threat_type = "RAT"
        
    strings:
        // PDB path indicator
        $pdb = "Crysome.Client.pdb" ascii wide
        
        // Namespace strings
        $ns1 = "Crysome.Client.Web" ascii wide
        $ns2 = "Crysome.Client.System" ascii wide
        $ns3 = "Crysome.Client.Handlers" ascii wide
        $ns4 = "Crysome.Client.Network" ascii wide
        $ns5 = "Crysome.Common.Network.Packets" ascii wide
        
        // Capability indicators
        $func1 = "RunPowerShell" ascii wide
        $func2 = "HandleDownloadFile" ascii wide
        $func3 = "DownloadFileRequestPacket" ascii wide
        $func4 = "HandleStartProxy" ascii wide
        $func5 = "HandleSocksClient" ascii wide
        $func6 = "WebFileDownloader" ascii wide
        
        // System info collection
        $info1 = "<ActiveWindowTitle>k__BackingField" ascii wide
        $info2 = "<CountryCode>k__BackingField" ascii wide
        $info3 = "<ComputerName>k__BackingField" ascii wide
        
        // .NET specific
        $dotnet = "mscoree.dll" ascii nocase
        $pe_sig = "PE\x00\x00" ascii
        
    condition:
        uint16(0) == 0x5A4D and // MZ header
        $pe_sig and
        $dotnet and
        (
            $pdb or
            (3 of ($ns*)) or
            (4 of ($func*)) or
            (all of ($info*))
        )
}
