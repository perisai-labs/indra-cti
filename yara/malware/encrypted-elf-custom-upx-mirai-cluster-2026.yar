rule Encrypted_ELF_CustomUPX_MiraiCluster_2026 {
    meta:
        description = "Detects ELF64 with custom modified UPX packer + stream-cipher encrypted payload from Mirai botnet infrastructure cluster"
        author = "Peris.ai Threat Research Team"
        date = "2026-02-17"
        hash_sha256 = "8d577a095d2dcc693ea232afc45c6c23dd83755496151ec708acc6216456032b"
        reference = "MalwareBazaar first_seen:2026-02-17"
        tlp = "TLP:WHITE"
        severity = "HIGH"
        family = "Mirai/CustomUPX"
        arch = "ELF64-x86_64"

    strings:
        // Modified UPX l_info: tampered checksum (0x2387B050) + UPX! magic + stub size 0x10E4 + version 14
        $upx_modified_header = { 50 B0 87 23 55 50 58 21 E4 10 0E 16 }

    condition:
        // ELF magic
        uint32(0) == 0x464C457F and
        // 64-bit (EI_CLASS = 2)
        uint8(4) == 2 and
        // x86-64 (e_machine little-endian = 0x003E)
        uint16(0x12) == 0x003E and
        // No section headers (stripped - e_shnum at 0x3C = 0)
        uint16(0x3C) == 0 and
        // 4 program headers (e_phnum at 0x38 = 4)
        uint16(0x38) == 4 and
        // Specific modified UPX l_info header at 0x150
        $upx_modified_header at 0x150 and
        // File size: packed 250-400KB
        filesize >= 200KB and filesize <= 600KB
}
