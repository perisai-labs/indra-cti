rule XWorm_RAT_Feb2026 {
    meta:
        description = "Detects XWorm RAT variant from February 2026"
        author = "Peris.ai Threat Research"
        date = "2026-02-20"
        hash = "f0c5a5dc4ab51d8f3988e778996419acdfd7aa66139d10fb17606efb7c284cc2"
        severity = "critical"
        reference = "https://bazaar.abuse.ch"
        
    strings:
        // Unique function names
        $func1 = "EncryptTextWithNQkey" ascii wide
        $func2 = "DecryptTextFromQNkey" ascii wide
        $func3 = "KDefenderV2" ascii wide
        $func4 = "RunJammerExe" ascii wide
        $func5 = "RunHvncX" ascii wide
        
        // Configuration markers
        $config1 = "EncHost" ascii wide
        $config2 = "EncPort" ascii wide
        $config3 = "IPHOST" ascii wide
        $config4 = "PortHost" ascii wide
        $config5 = "Mutexx" ascii wide
        
        // Remote desktop capabilities
        $rdp1 = "RemoteDesktop" ascii wide
        $rdp2 = "DesktopHelper" ascii wide
        $rdp3 = "AppendOutputTextDelegate" ascii wide
        $rdp4 = "GetDesktopNames" ascii wide
        
        // Process injection
        $inj1 = "svchost.exe" ascii wide
        $inj2 = "VirtualProtect" ascii wide
        
        // Persistence
        $persist1 = "InstAutoStart" ascii wide
        $persist2 = "IsAutostartInstalled" ascii wide
        
        // PE header
        $mz = "MZ"
        
    condition:
        uint16(0) == 0x5A4D and
        filesize < 100KB and
        (
            // Strong signature: encryption functions + config markers
            (2 of ($func*) and 2 of ($config*)) or
            // Alternative: RDP + injection + persistence
            (2 of ($rdp*) and 1 of ($inj*) and 1 of ($persist*)) or
            // High confidence: 5+ unique strings
            (5 of them)
        )
}
