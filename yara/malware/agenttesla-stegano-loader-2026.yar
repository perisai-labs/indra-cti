rule AgentTesla_SteganoLoader_Feb2026 {
    meta:
        description = "Detects AgentTesla variants using steganography bitmap loader"
        author = "Peris.ai Threat Research Team"
        date = "2026-02-11"
        severity = "HIGH"
        hash = "a9b670ff357cbb942a795c8524999072cd9466486b9c28b5b0d809b01547293b"
        reference = "https://github.com/perisai-labs/indra-cti"

    strings:
        $dotnet = "v4.0.30319" ascii
        $bmp1 = "System.Drawing.Bitmap" ascii
        $bmp2 = "GetPixel" ascii
        $bmp3 = "FromArgb" ascii
        $load1 = "Assembly" ascii
        $load2 = "Load" ascii
        $load3 = "EntryPoint" ascii
        $load4 = "Invoke" ascii
        $anti1 = "GetForegroundWindow" ascii
        $anti2 = "GetWindowText" ascii
        $fname = "new_order" ascii nocase
        $ext = ".com.exe" ascii nocase

    condition:
        uint16(0) == 0x5A4D and
        $dotnet and
        (
            (2 of ($bmp*) and 2 of ($load*)) or
            (all of ($bmp*) and 1 of ($anti*)) or
            ($fname and $ext)
        )
}
