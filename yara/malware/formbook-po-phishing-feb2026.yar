rule Formbook_PO_Phishing_AutoIt_Feb2026 {
    meta:
        description = "Formbook infostealer via PO-themed phishing, AutoIt loader - Brazil campaign Feb 2026"
        author = "Peris.ai Threat Research"
        date = "2026-02-18"
        hash = "892bc644461156b75443af62eb4b44e88b0ad36f9c19dad0bb6064be7a612db7"
        severity = "HIGH"
        tlp = "WHITE"
    strings:
        $autoit_sig   = "This is a third-party compiled AutoIt script." ascii
        $autoit_sc    = ".text$lp00AutoItSC" ascii
        $api_valloc   = "VirtualAllocEx" ascii
        $api_wpm      = "WriteProcessMemory" ascii
        $api_resume   = "ResumeThread" ascii
        $net_http1    = "HttpOpenRequestW" ascii
        $net_http2    = "HttpSendRequestW" ascii
        $mutex1       = "6-450OAE02468WZz" ascii wide
        $mutex2       = "5N0NO7658UY-E89K" ascii wide
        $xor_key      = "Tc55s2WqM" ascii
        $payload_name = "polygamodioecious" ascii wide
        $po_pdf_ext   = "_pdf.exe" nocase ascii wide
    
    condition:
        uint16(0) == 0x5A4D and
        filesize >= 500KB and filesize <= 5MB and
        (
            (($autoit_sig or $autoit_sc) and $api_valloc and $api_wpm and ($net_http1 or $net_http2)) or
            ($po_pdf_ext and $api_valloc and $api_wpm and $api_resume) or
            (($mutex1 or $mutex2) and $api_valloc and $api_wpm) or
            ($xor_key or $payload_name)
        )
}

rule Formbook_AutoIt_Loader_Generic {
    meta:
        description = "Generic AutoIt-compiled Formbook loader with process injection"
        author = "Peris.ai Threat Research"
        date = "2026-02-18"
        severity = "HIGH"
        tlp = "WHITE"
    strings:
        $autoit_compiled = "This is a third-party compiled AutoIt script." ascii
        $api_valloc      = "VirtualAllocEx" ascii
        $api_wpm         = "WriteProcessMemory" ascii
        $api_resume      = "ResumeThread" ascii
        $net_wininet1    = "HttpOpenRequestW" ascii
        $winmm           = "WINMM.dll" ascii
    
    condition:
        uint16(0) == 0x5A4D and
        filesize >= 500KB and filesize <= 10MB and
        $autoit_compiled and
        $api_valloc and $api_wpm and $api_resume and
        $net_wininet1 and $winmm
}
